<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Digital tvilling - Geodata</title>

    <link rel="stylesheet" href="https://js.arcgis.com/4.11/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.11/"></script>

    <style>
        html,
        body,
        #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
        
        #paneDiv {
            padding: 10px;
            max-width: 200px;
            background-color: rgba(255, 255, 255, 0.8);
            font-size: 1.1em;
        }
        
        #credits {
            font-size: 0.7em;
            line-height: 1.1em;
        }
    </style>








    </head>


    <body>

       
        <div id="viewDiv"></div>
        </div>
    </body>

    <script>
        require([
                "esri/Map",
                "esri/WebScene",
                "esri/views/SceneView",
                "esri/Basemap",
                "esri/layers/Layer",
                "esri/layers/SceneLayer",
                "esri/layers/FeatureLayer",
                "esri/layers/ElevationLayer",
                "esri/layers/GraphicsLayer",
                "esri/widgets/Sketch/SketchViewModel",
                "esri/symbols/WebStyleSymbol",
                "esri/views/layers/support/FeatureFilter",
                "esri/geometry/geometryEngine",
                "esri/Graphic",
                "esri/renderers/ClassBreaksRenderer"
            ],
            function(Map, WebScene, SceneView, Basemap, Layer, SceneLayer, FeatureLayer, ElevationLayer, GraphicsLayer, SketchViewModel, WebStyleSymbol, Graphic, geometryEngine, FeatureFilter, ClassBreaksRenderer) {


                const defExpression = "byggnr <> 81809542 AND byggnr <> 81809569 AND byggnr <> 81809488";
                const defExpressionHiglight = "byggnr = 81809542 or byggnr = 81809569 or byggnr = 81809488 or byggnr = 80725728 or byggnr = 80772092 or byggnr = 80835337 or byggnr = 81050821 or byggnr = 81097607";


                //-------------------RENDERS------------------------------------------------------


                //--------Polyrendrer - Simple---------------------
                var polyrend = {
                    type: "simple",
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()

                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#f44141",

                            },
                            edges: {
                                type: "solid",
                                color: "#4d5b18",
                                size: 1.5
                            },
                            size: 5.6,
                            opacity: 0.8
                        }]
                    }
                };
                //------------------------------------------------------------------------------- 

                //--------Polyrendrer - Edge---------------------
                var EdgeRenderer = {
                    type: "simple", // autocasts as new SimpleRenderer()
                    // Add a default MeshSymbol3D. The color will be determined
                    // by the visual variables
                    symbol: {
                      type: "mesh-3d",
                      symbolLayers: [
                        {
                          type: "fill",
                          material: {
                            color: [255, 255, 255, 0.3],
                            colorMixMode: "replace"
                          },
                          edges: {
                            type: "solid",
                            color: [0, 0, 0],
                            size: 1.5
                          }
                        }
                      ]
                    },
                };

                //-------------------------------------------------------------------------------     

                //--------Polyrendrer - prox---------------------
                var NotPresentSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [0, 255, 0, 0.3],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 3
                    }]
                };

                var PresentSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [255, 0, 0, 0.3],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 3
                    }]
                };

                var DisTechRendrerPROX = {
                    type: "unique-value", // autocasts as new UniqueValueRenderer()
                    defaultSymbol: {
                        type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ExtrudeSymbol3DLayer()
                            material: {
                                color: [204, 204, 204, 0.3],
                            },
                            edges: {
                                type: "solid",
                                color: "#333333",
                                size: 1.5
                            },
                            size: 3
                        }]
                    },
                    defaultLabel: "Other",
                    field: "Status",
                    uniqueValueInfos: [{
                        value: "PRESENT",
                        symbol: PresentSymbol,
                        label: "PresentSymbol"
                    }, {
                        value: "NOT_PRESENT",
                        symbol: NotPresentSymbol,
                        label: "NOT_PRESENT"
                    }],

                };
                //-----------------------------------------------


                //--------Polyrendrer - Temp---------------------
                var FlateRendererDistTech = new ClassBreaksRenderer({
                    // type: "class-breaks",
                    // attribute of interest - Earthquake magnitude
                    valueExpression: "if ( $feature.ETASJE_TOPOLOGISK == 2) {return 0} else {return $feature.Temp}"
                });

                // All features with magnitude between 0 - 4.0
                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 0.0,
                    maxValue: 1.0,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#4286f4"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 1.0,
                    maxValue: 1.75,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#ec1d23"
                            },
                            size: 5.6
                        }]
                    }
                });

                // All features with magnitude between 4.1 - 7.0
                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 1.76,
                    maxValue: 2.5,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#f37b7d"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 23,
                    maxValue: 24.5,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#42f480"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 24.6,
                    maxValue: 50,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#e50d18"
                            },
                            size: 5.6
                        }]
                    }
                });



                var FlateRendererNordigi = new ClassBreaksRenderer({
                    // type: "class-breaks",
                    // attribute of interest - Earthquake magnitude
                    valueExpression: "if ( $feature.ETASJE_TOPOLOGISK == 2) {return 0} else {return $feature.Temp}"
                });

                // All features with magnitude between 0 - 4.0
                FlateRendererNordigi.addClassBreakInfo({
                    minValue: 0.0,
                    maxValue: 10,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#4286f4"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererNordigi.addClassBreakInfo({
                    minValue: 10.1,
                    maxValue: 100,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#ec1d23"
                            },
                            size: 5.6
                        }]
                    }
                });

               

                //-----------------------------------------------
                //--------ekisterendeBygg---------------------
                var solidEdges = {
                    type: "solid",
                    color: [0, 0, 0, 0.6],
                    size: 1
                };

                var byggRenderer = {
                    type: "simple", // autocasts as new SimpleRenderer()
                    symbol: {
                        type: "mesh-3d",
                        symbolLayers: [{
                            type: "fill",
                            material: {
                                color: "#ffffff",
                                colorMixMode: "replace"
                            },
                            edges: solidEdges
                        }]
                    },
                };

                var byggRendererHiglight = {
                    type: "simple", // autocasts as new SimpleRenderer()
                    symbol: {
                        type: "mesh-3d",
                        symbolLayers: [{
                            type: "fill",
                            material: {
                                color: "#42ebf4",
                                colorMixMode: "replace"
                            },
                            edges: solidEdges
                        }]
                    },
                };



                //---------------------------------------------------------------------------------

                //--------PersonRendrer---------------------


                var verticalOffset = {
                    screenLength: 5,
                    maxWorldLength: 25,
                    minWorldLength: 4
                };


                function getUniqueValueSymbol(name, color) {
                    // The point symbol is visualized with an icon symbol. To clearly see the location of the point
                    // we displace the icon vertically and add a callout line. The line connects the offseted symbol with the location
                    // of the point feature.
                    return {
                    type: "point-3d", // autocasts as new PointSymbol3D()
                    symbolLayers: [{
                        type: "icon", // autocasts as new IconSymbol3DLayer()
                        resource: {
                        href: name
                        },
                        size: 400,
                        outline: {
                        color: "white",
                        size: 10
                        }
                    }],
    
                    verticalOffset: verticalOffset,
    
                    callout: {
                        type: "line", // autocasts as new LineCallout3D()
                        color: "white",
                        size: 50,
                        border: {
                        color: color
                        }
                    }
                    };
                }
    
                var pointsRenderer = {
                    type: "unique-value", // autocasts as new UniqueValueRenderer()
                    field: "Stasjonsnavn",
                    uniqueValueInfos: [{
                    value: 1,
                    symbol: getUniqueValueSymbol("https://developers.arcgis.com/javascript/latest/sample-code/visualization-point-styles/live/Museum.png", "#d63031")
                    
                    }]
                };
    
    
                var personsymbol = [{
                    value: "Person1",
                    name: "Standing Inverted Cone",
                 }, {
                    value: "Person2",
                    name: "Standing Inverted Cone",
                 }, {
                    value: "Person3",
                    name: "Standing Cylinder",
                 }, {
                    value: "Person4",
                    name: "Standing Inverted Cone",
                 }, {
                    value: "Person5",
                    name: "Standing Inverted Cone",
                 }, {
                    value: "Person6",
                    name: "Standing Inverted Cone",
                }];

                //---------------------------------------------------------------------------------



                //-----------------------LAG------------------------------------------------------


                const geodataDigitaltvilling_kursrom_NorDIGI_sensor= new FeatureLayer({
                    url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/DigitalTvilling_Geodata/FeatureServer/3",
                    outFields: ["*"],
                    purgeOptions: {
                        displayCount: 1000
                    },
                    renderer: FlateRendererNordigi,
                    //popupTemplate: template,
                    refreshInterval: 0.01,
                    elevationInfo: {
                        // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                        mode: "absolute-height",
                        offset: 2.8
                    },

                }

            );


                const geodataDigitaltvilling_kursrom_PROX_sensor= new FeatureLayer({
                    url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/Kursplass/FeatureServer",
                    outFields: ["*"],
                    purgeOptions: {
                        displayCount: 1000
                    },
                    renderer: DisTechRendrerPROX,
                    //popupTemplate: template,
                    refreshInterval: 0.01,
                    elevationInfo: {
                        // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                        mode: "absolute-height",
                        offset: 2.8
                    },

                }

            );

                const geodataDigitaltvilling_rom = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Rom_Massiv/SceneServer",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: EdgeRenderer,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_rom_wc_etg01 = new FeatureLayer({
                    url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/DigitalTvilling_Geodata/FeatureServer/2",
                    definitionExpression: "Name NOT LIKE ''",
                    outFields: ["*"],
                    purgeOptions: {
                        displayCount: 1000
                    },
                    renderer: DisTechRendrerPROX,
                    //popupTemplate: template,
                    refreshInterval: 0.01,
                    elevationInfo: {
                        // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                        mode: "absolute-height",
                        offset: 2.8
                    },

                }

            );

                const geodataDigitaltvilling_plan = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_plan/SceneServer",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_langbord = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_langbord/SceneServer",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_WC = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_WC/SceneServer",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_Trapp = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Trapp/SceneServer",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_Soyler = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_S%C3%B8yler/SceneServer",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_Planter = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Planter/SceneServer",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_Bokhylle = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Bokhylle/SceneServer",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_Arbeidsplass = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Arbeidsplass/SceneServer",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const personDigitaltvilling = new FeatureLayer({
                    url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/PersonerDigitalTvilling/FeatureServer",
                    outFields: ["*"],
                    purgeOptions: {
                        displayCount: 1000
                    },
                    renderer: pointsRenderer,
                    //popupTemplate: template,
                    refreshInterval: 0.01,
                    elevationInfo: {
                        // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                        mode: "absolute-height",
                        offset: 2.8
                    },

                }

            );

                const Bygninger_Norge_Oslo = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/PdUYt91ohJfR04kk/arcgis/rest/services/Bygninger_Norge_OsloSommerkonf_20180730_124537/SceneServer",
                        definitionExpression: defExpression,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: byggRenderer,
                        opacity: 0.3,

                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "on-the-ground",
                            //offset: 2.8
                        },

                    }

                );


                const Bygninger_Norge_Oslo_highligted = new SceneLayer({
                    url: "https://tiles.arcgis.com/tiles/PdUYt91ohJfR04kk/arcgis/rest/services/Bygninger_Norge_OsloSommerkonf_20180730_124537/SceneServer",
                    definitionExpression: defExpressionHiglight,
                    outFields: ["*"],
                    purgeOptions: {
                        displayCount: 1000
                    },
                    renderer: byggRendererHiglight,
                    //opacity: 0.3,

                    //popupTemplate: template,
                    refreshInterval: 0.01,
                    elevationInfo: {
                        // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                        mode: "on-the-ground",
                        //offset: 2.8
                    },

                }

            );




                var basemap = new Basemap({
                    portalItem: {
                        id: "c6cd79d600094e3d83a08cad9d3c1aa0" // gråtone
                    }
                });

                var elevLyr = new ElevationLayer({
                    portalItem: {
                        id: "4526a4d94b844467a3ce130da8ca172d"
                    }
                });

                const gLayer = new GraphicsLayer();

                var map = new Map({
                    basemap: basemap,
                    //ground: "world-elevation",
                    layers: [personDigitaltvilling, Bygninger_Norge_Oslo_highligted, geodataDigitaltvilling_rom, geodataDigitaltvilling_rom_wc_etg01, geodataDigitaltvilling_kursrom_PROX_sensor, Bygninger_Norge_Oslo, geodataDigitaltvilling_plan, geodataDigitaltvilling_Arbeidsplass, geodataDigitaltvilling_Bokhylle, geodataDigitaltvilling_Planter, geodataDigitaltvilling_Soyler, geodataDigitaltvilling_Trapp, geodataDigitaltvilling_WC, geodataDigitaltvilling_langbord],
                    ground: {
                        surfaceColor: "#2A282B"
                    }
                });


                map.ground.layers.add(elevLyr);

                var view = new SceneView({
                    container: "viewDiv",
                    map: map,
                    alphaCompositingEnabled: true,
                    environment: {
                        background: {
                            type: "color", // autocasts as new ColorBackground()
                            color: "#2A282B"
                        },
                        // disable stars
                        starsEnabled: false,
                        //disable atmosphere
                        atmosphereEnabled: false
                    },
                    center: {
                        x: 263164.68078,
                        y: 6649010.9098,
                        z: 100,
                        spatialReference: 25833
                    }

                });

                view.watch("scale", function(newValue) {
                    //geodataDigitaltvilling_rom_wc_etg01.renderer = newValue <= 72224 ? simpleRenderer : DisTechRendrerPROX;

                    if (newValue < 1000) {
                        // Bygninger_Norge_Oslo.definitionExpression = defExpression;
                        Bygninger_Norge_Oslo_highligted.visible = false;
                    } else {
                        // Bygninger_Norge_Oslo.definitionExpression = '';
                        Bygninger_Norge_Oslo_highligted.visible = true;
                    }
                });





            });
    </script>

    </body>

</html>